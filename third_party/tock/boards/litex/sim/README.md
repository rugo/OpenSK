LiteX SoC in a Verilated Simulation
============================================

This board is targeting a
[verilated](https://www.veripool.org/wiki/verilator) SoC bitstream
built using [LiteX](https://github.com/enjoy-digital/litex).

Since LiteX is a SoC builder, the individual generated bitstreams can
differ significantly depending on the release and configuration
options used. This board definition currently targets and has been
tested with
- [the LiteX SoC generator, revision
  444a605dea](https://github.com/enjoy-digital/litex/tree/4092180662ec62cf28b9283a020f1ff7f0892c19)
- using the included [lx_sim.py](https://github.com/enjoy-digital/litex/blob/4092180662ec62cf28b9283a020f1ff7f0892c19/litex/tools/litex_sim.py)
- built around a VexRiscv-CPU
- featuring a TIMER0 with 64-bit wide hardware uptime
- along with the following configuration options:

  ```
  --csr-data-width=32
  --integrated-rom-size=1048576
  --cpu-variant=secure
  --with-ethernet
  --rom-init $PATH_TO_TOCK_BINARY
  ```

Many bitstream customizations can be represented in the Tock board by
simply changing the variables in `src/litex_generated.rs`. To support
a different set of FPGA cores and perform further modifications, the
`src/main.rs` file will have to be modified.


Building the SoC / Programming the FPGA
---------------------------------------

Please refer to the [LiteX
documentation](https://github.com/enjoy-digital/litex/wiki/) for
instructions on how to install and use the LiteX SoC generator.

Once LiteX is installed, running the simulation:

```
$ cd $PATH_TO_LITEX/litex/tools
$ ./litex_sim.py <configuration options above>
```

This command will build the SoC Verilog files and a LiteX ROM BIOS.
Afterwards, it will use Verilator to create a C++ simulation program,
which is compiled and run. The script may ask for an administrator
password to create a `tap0` network device on the host if built with
Ethernet support. The Tock kernel is included as the integrated ROM
(loaded at address `0x0`) by using the `--rom-init
$PATH_TO_TOCK_BINARY`.

If everything works you should be greeted by the Tock kernel:
```
...
[xgmii_ethernet] loaded (0xa51090)
[clocker] loaded
[clocker] sys_clk: freq_hz=1000000, phase_deg=0
Verilated LiteX+VexRiscv: initialization complete, entering main loop.
```

Debugging
---------

LiteX makes it easy to generate vastly different SoCs. Prior to
creating an issue on GitHub, please verify that all variables in
`src/litex_generated.rs` correspond to the values provided to LiteX or
generated by it. The respective file paths for the source of each
value is included as a comment.

It is possible to extend the VexRiscv-CPU with a debug port, which is
exposed on the Wishbone bus of the SoC. This can then be used to
attach a GDB debugger via the Network using the Etherbone
(`--with-etherbone`) core. For more information refer to the LiteX
documentation and [this quickstart
guide](https://github.com/timvideos/litex-buildenv/wiki/Debugging).
